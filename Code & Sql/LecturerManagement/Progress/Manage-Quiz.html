<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Quizzes</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      display: flex;
      justify-content: center; /* Center the nav content */
      align-items: center;
      padding: 2rem 3rem; /* Updated padding */
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .logo {
      font-weight: bold;
      color: #3a913f;
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s ease;
      position: absolute; /* Keep logo on the left */
      left: 3rem; /* Align with padding */
    }

    .logo:hover {
      color: #2a7a2f;
    }

    nav {
      display: flex;
      justify-content: center; /* Center the nav ul */
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 1rem;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      text-decoration: none;
      color: #333;
      font-weight: 500;
    }

    main {
      padding: 2rem;
      text-align: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #222;
    }

    .quiz-list {
      max-width: 900px;
      margin: 0 auto;
    }

    .quiz-card {
      background-color: #daf7c3;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 8px 8px 0 #72b840;
      text-align: left;
      position: relative;
    }

    .quiz-title {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: #2a5a2d;
    }

    .quiz-meta {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: #555;
    }

    .quiz-description {
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .quiz-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .edit-btn {
      background-color: #4CAF50;
      color: white;
    }

    .edit-btn:hover {
      background-color: #45a049;
    }

    .delete-btn {
      background-color: #f44336;
      color: white;
    }

    .delete-btn:hover {
      background-color: #d32f2f;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 2rem;
      border-radius: 16px;
      width: 80%;
      max-width: 600px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
      color: #3a913f;
      margin: 0;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #777;
    }

    .form-group {
      margin-bottom: 1rem;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .cancel-btn {
      background-color: #f1f1f1;
      color: #333;
    }

    .cancel-btn:hover {
      background-color: #e0e0e0;
    }

    .save-btn {
      background-color: #4CAF50;
      color: white;
    }

    .save-btn:hover {
      background-color: #45a049;
    }

    .search-bar {
      margin-bottom: 2rem;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .search-bar input {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 24px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    .search-bar input:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
    }

    .no-quizzes {
      padding: 2rem;
      background-color: #f1f1f1;
      border-radius: 8px;
      color: #666;
    }
  </style>
</head>
<body>
    <header>
        <div class="logo" onclick="window.location.href='lecturer-dashboard.html'">Lecturer Management</div>
        <nav>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Quizzes</a></li>
            <li><a href="#">Materials</a></li>
            <li><a href="#">Leaderboard</a></li>
            <li><a href="#">Study Timer</a></li>
          </ul>
        </nav>
      </header>

  <main>
    <h1>Manage Quizzes</h1>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search quizzes...">
    </div>

    <div class="quiz-list" id="quizList">
      <!-- Quizzes will be loaded here dynamically -->
    </div>

    <!-- Edit Quiz Modal -->
    <div class="modal" id="editModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Edit Quiz</h2>
          <button class="close-btn" id="closeEditModal">×</button>
        </div>
        <form id="editQuizForm">
          <input type="hidden" id="editQuizId">
          <div class="form-group">
            <label for="editQuizTitle">Quiz Title</label>
            <input type="text" id="editQuizTitle" required>
          </div>
          <div class="form-group">
            <label for="editRoomType">Room Type</label>
            <select id="editRoomType" required>
              <option value="Public Room">Public Room</option>
              <option value="Private Room">Private Room</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editPlayerMode">Player Mode</label>
            <select id="editPlayerMode" required>
              <option value="Multiplayer">Multiplayer</option>
              <option value="Solo Mode">Solo Mode</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editDifficultyLevel">Difficulty Level</label>
            <select id="editDifficultyLevel" required>
              <option value="Easy">Easy</option>
              <option value="Medium">Medium</option>
              <option value="Hard">Hard</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editQuizDescription">Description</label>
            <textarea id="editQuizDescription" required></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="action-btn cancel-btn" id="cancelEdit">Cancel</button>
            <button type="submit" class="action-btn save-btn">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Confirm Deletion</h2>
          <button class="close-btn" id="closeDeleteModal">×</button>
        </div>
        <p>Are you sure you want to delete this quiz? This action cannot be undone.</p>
        <div class="modal-actions">
          <button type="button" class="action-btn cancel-btn" id="cancelDelete">Cancel</button>
          <button type="button" class="action-btn delete-btn" id="confirmDelete">Delete</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Sample quiz data - in a real app, this would come from your database
    let Quizzes = [
      {
        id: 1,
        title: "Basic Arithmetic",
        roomType: "Public Room",
        playerMode: "Multiplayer",
        difficulty: "Easy",
        description: "A basic algebra and geometry quiz for beginners.",
        subject: "Mathematics"
      },
      {
        id: 2,
        title: "Chemical Formula",
        roomType: "Public Room",
        playerMode: "Solo Mode",
        difficulty: "Easy",
        description: "Introduction to chemical formula",
        subject: "Science"
      },
      {
        id: 3,
        title: "Sports Trivia",
        roomType: "Public Room",
        playerMode: "Multiplayer",
        difficulty: "Medium",
        description: "Test your knowledge of various sports",
        subject: "Sports"
      },
      {
        id: 4,
        title: "Human Biology",
        roomType: "Public Room",
        playerMode: "Multiplayer",
        difficulty: "Medium",
        description: "Test your knowledge of human anatomy and physiology",
        subject: "Science"
      },
      {
        id: 5,
        title: "Programming Basics",
        roomType: "Private Room",
        playerMode: "Solo Mode",
        difficulty: "Easy",
        description: "Introduction to programming concepts",
        subject: "Computer Science"
      }
    ];

    // DOM elements
    const quizList = document.getElementById('quizList');
    const searchInput = document.getElementById('searchInput');
    const editModal = document.getElementById('editModal');
    const deleteModal = document.getElementById('deleteModal');
    const editQuizForm = document.getElementById('editQuizForm');
    const closeEditModal = document.getElementById('closeEditModal');
    const cancelEdit = document.getElementById('cancelEdit');
    const closeDeleteModal = document.getElementById('closeDeleteModal');
    const cancelDelete = document.getElementById('cancelDelete');
    const confirmDelete = document.getElementById('confirmDelete');

    // Current quiz being edited/deleted
    let currentQuizId = null;
    let quizzes = [];

    // Fetch quizzes from database
    async function fetchQuizzes() {
        try {
            const response = await fetch('quiz_api.php');
            const data = await response.json();
            
            if (data.success) {
                quizzes = data.quizzes;
                displayQuizzes(quizzes);
            } else {
                console.error('Error fetching quizzes:', data.message);
                alert('Failed to load quizzes. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while loading quizzes.');
        }
    }

    // Display quizzes
    function displayQuizzes(quizzesToDisplay) {
        if (quizzesToDisplay.length === 0) {
            quizList.innerHTML = '<div class="no-quizzes">No quizzes found. Create a new quiz to get started.</div>';
            return;
        }

        quizList.innerHTML = quizzesToDisplay.map(quiz => `
            <div class="quiz-card" data-id="${quiz.id}">
                <div class="quiz-title">${quiz.title}</div>
                <div class="quiz-meta">
                    <span>Subject: ${quiz.subject}</span>
                    <span>Mode: ${quiz.playerMode}</span>
                    <span>Difficulty: ${quiz.difficulty}</span>
                    <span>Room: ${quiz.roomType}</span>
                </div>
                <div class="quiz-description">${quiz.description}</div>
                <div class="quiz-actions">
                    <button class="action-btn edit-btn" data-id="${quiz.id}">Edit</button>
                    <button class="action-btn delete-btn" data-id="${quiz.id}">Delete</button>
                </div>
            </div>
        `).join('');

        // Add event listeners to edit and delete buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                currentQuizId = e.target.getAttribute('data-id');
                openEditModal(currentQuizId);
            });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                currentQuizId = e.target.getAttribute('data-id');
                openDeleteModal(currentQuizId);
            });
        });
    }

    // Open edit modal with quiz data
    function openEditModal(quizId) {
        const quiz = quizzes.find(q => q.id == quizId);
        if (quiz) {
            document.getElementById('editQuizId').value = quiz.id;
            document.getElementById('editQuizTitle').value = quiz.title;
            document.getElementById('editRoomType').value = quiz.roomType;
            document.getElementById('editPlayerMode').value = quiz.playerMode;
            document.getElementById('editDifficultyLevel').value = quiz.difficulty;
            document.getElementById('editQuizDescription').value = quiz.description;
            editModal.style.display = 'flex';
        }
    }

    // Open delete confirmation modal
    function openDeleteModal(quizId) {
        deleteModal.style.display = 'flex';
    }

    // Close all modals
    function closeModals() {
        editModal.style.display = 'none';
        deleteModal.style.display = 'none';
    }

    // Filter quizzes based on search input
    function filterQuizzes() {
        const searchTerm = searchInput.value.toLowerCase();
        const filteredQuizzes = quizzes.filter(quiz => 
            quiz.title.toLowerCase().includes(searchTerm) || 
            quiz.description.toLowerCase().includes(searchTerm) ||
            quiz.subject.toLowerCase().includes(searchTerm)
        );
        displayQuizzes(filteredQuizzes);
    }

    // Update quiz in database
    async function updateQuiz(quizData) {
        try {
            const response = await fetch('quiz_api.php', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(quizData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                await fetchQuizzes(); // Refresh the quiz list
                return true;
            } else {
                console.error('Error updating quiz:', data.message);
                alert('Failed to update quiz. Please try again.');
                return false;
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while updating the quiz.');
            return false;
        }
    }

    // Delete quiz from database
    async function deleteQuiz(quizId) {
        try {
            const response = await fetch('quiz_api.php', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: quizId })
            });
            
            const data = await response.json();
            
            if (data.success) {
                await fetchQuizzes(); // Refresh the quiz list
                return true;
            } else {
                console.error('Error deleting quiz:', data.message);
                alert('Failed to delete quiz. Please try again.');
                return false;
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while deleting the quiz.');
            return false;
        }
    }

    // Event listeners
    searchInput.addEventListener('input', filterQuizzes);

    closeEditModal.addEventListener('click', closeModals);
    cancelEdit.addEventListener('click', closeModals);
    closeDeleteModal.addEventListener('click', closeModals);
    cancelDelete.addEventListener('click', closeModals);

    editQuizForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const quizData = {
            id: currentQuizId,
            title: document.getElementById('editQuizTitle').value,
            roomType: document.getElementById('editRoomType').value,
            playerMode: document.getElementById('editPlayerMode').value,
            difficulty: document.getElementById('editDifficultyLevel').value,
            description: document.getElementById('editQuizDescription').value
        };
        
        const success = await updateQuiz(quizData);
        if (success) {
            closeModals();
        }
    });

    confirmDelete.addEventListener('click', async () => {
        const success = await deleteQuiz(currentQuizId);
        if (success) {
            closeModals();
        }
    });

    // Initialize the page
    fetchQuizzes();
  </script>
</body>
</html>